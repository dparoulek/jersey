<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Jersey 1.0.3.1 User Guide</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.73.2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d4e1"></a>Jersey 1.0.3.1 User Guide</h1></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#d4e4">Preface</a></span></dt><dt><span class="chapter"><a href="#d4e8">1. Overview of JAX-RS 1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e15">1.1. Root Resource Classes</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e31">1.1.1. @Path</a></span></dt><dt><span class="section"><a href="#d4e56">1.1.2. HTTP Methods</a></span></dt><dt><span class="section"><a href="#d4e71">1.1.3. @Produces</a></span></dt><dt><span class="section"><a href="#d4e103">1.1.4. @Consumes</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e115">1.2. Deploying a RESTful Web Service</a></span></dt><dt><span class="section"><a href="#d4e147">1.3. Extracting Request Parameters</a></span></dt><dt><span class="section"><a href="#d4e221">1.4. Represetations and Java Types</a></span></dt><dt><span class="section"><a href="#d4e254">1.5. Building Responses</a></span></dt><dt><span class="section"><a href="#d4e271">1.6. Sub-resources</a></span></dt><dt><span class="section"><a href="#d4e302">1.7. Building URIs</a></span></dt><dt><span class="section"><a href="#d4e331">1.8. WebApplicationException and Mapping Exceptions to Responses</a></span></dt><dt><span class="section"><a href="#d4e361">1.9. Conditional GETs and Returning 304 (Not Modified) Responses</a></span></dt><dt><span class="section"><a href="#d4e379">1.10. Life-cycle of Root Resource Classes</a></span></dt><dt><span class="section"><a href="#d4e387">1.11. Security</a></span></dt><dt><span class="section"><a href="#d4e400">1.12. Rules of Injection</a></span></dt><dt><span class="section"><a href="#d4e412">1.13. Use of @Context</a></span></dt><dt><span class="section"><a href="#d4e424">1.14. Annotations Defined By JAX-RS</a></span></dt></dl></dd><dt><span class="chapter"><a href="#json">2. JSON Support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e442">2.1. JAXB Based JSON support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e457">2.1.1. Configuration Options</a></span></dt><dt><span class="section"><a href="#d4e478">2.1.2. JSON Notations</a></span></dt><dt><span class="section"><a href="#d4e624">2.1.3. Examples</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e629">2.2. Low-Level JSON support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e643">2.2.1. Examples</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>1.1. <a href="#d4e28">Simple hello world root resource class</a></dt><dt>1.2. <a href="#d4e47">Specifying URI path parameter</a></dt><dt>1.3. <a href="#d4e67">PUT method</a></dt><dt>1.4. <a href="#d4e78">Specifying output MIME type</a></dt><dt>1.5. <a href="#d4e97">Using multiple output MIME types</a></dt><dt>1.6. <a href="#d4e108">Specifying input MIME type</a></dt><dt>1.7. <a href="#d4e120">Deployment agnostic application model</a></dt><dt>1.8. <a href="#d4e125">Reusing Jersey implementation in your custom application model</a></dt><dt>1.9. <a href="#d4e134">Deployment of your application using Jersey specific servlet</a></dt><dt>1.10. <a href="#d4e138">Using Jersey specific servlet without an application model instance</a></dt><dt>1.11. <a href="#d4e154">Query parameters</a></dt><dt>1.12. <a href="#d4e160">Custom Java type for consuming request parameters</a></dt><dt>1.13. <a href="#d4e202">Processing POSTed HTML form</a></dt><dt>1.14. <a href="#d4e207">Obtaining general map of URI path and/or query parameters</a></dt><dt>1.15. <a href="#d4e212">Obtaining general map of header parameters</a></dt><dt>1.16. <a href="#d4e218">Obtaining general map of form parameters</a></dt><dt>1.17. <a href="#d4e239">Using <code class="code">File</code> with a specific MIME type to produce a response</a></dt><dt>1.18. <a href="#d4e249">The most acceptable MIME type is used when multiple output MIME types allowed</a></dt><dt>1.19. <a href="#d4e261">Returning 201 status code and adding <code class="literal">Location</code> header in response to POST request</a></dt><dt>1.20. <a href="#d4e267">Adding an entity body to a custom response</a></dt><dt>1.21. <a href="#d4e280">Sub-resource methods</a></dt><dt>1.22. <a href="#d4e293">Sub-resource locators</a></dt><dt>1.23. <a href="#d4e314">URI building</a></dt><dt>1.24. <a href="#d4e328">Building URIs using query parameters</a></dt><dt>1.25. <a href="#d4e337">Throwing Jersey specific exceptions to control response</a></dt><dt>1.26. <a href="#d4e343">Jersey specific exception implementation</a></dt><dt>1.27. <a href="#d4e352">Mapping generic exceptions to responses</a></dt><dt>1.28. <a href="#d4e368">Conditional GET support</a></dt><dt>1.29. <a href="#d4e396">Accessing <code class="code">SecurityContext</code></a></dt><dt>1.30. <a href="#d4e405">Injection</a></dt><dt>2.1. <a href="#d4e447">Simple JAXB bean implementation</a></dt><dt>2.2. <a href="#d4e450">JAXB bean used to generate JSON representation</a></dt><dt>2.3. <a href="#d4e461">Tweaking JSON format using JAXB</a></dt><dt>2.4. <a href="#json.jaxb.context.resolver.example">An example of a JAXBContext resolver implementation</a></dt><dt>2.5. <a href="#d4e491">JAXB beans for JSON supported notations description, simple address bean</a></dt><dt>2.6. <a href="#d4e494">JAXB beans for JSON supported notations description, contact bean</a></dt><dt>2.7. <a href="#json.jaxb.bean.init.example">JAXB beans for JSON supported notations description, initialization</a></dt><dt>2.8. <a href="#d4e516">JSON expression produced using <code class="literal">mapped</code> notation</a></dt><dt>2.9. <a href="#d4e529">Force arrays in <code class="literal">mapped</code> JSON notation</a></dt><dt>2.10. <a href="#d4e540">Force non-string values in <code class="literal">mapped</code> JSON notation</a></dt><dt>2.11. <a href="#d4e553">XML attributes as XML elements in <code class="literal">mapped</code> JSON notation</a></dt><dt>2.12. <a href="#d4e560">Keep XML root tag equivalent in JSON <code class="literal">mapped</code> JSON notation</a></dt><dt>2.13. <a href="#d4e565">XML root tag equivalent kept in JSON using <code class="literal">mapped</code> notation</a></dt><dt>2.14. <a href="#d4e580">JSON expression produced using <code class="literal">natural</code> notation</a></dt><dt>2.15. <a href="#d4e595">JSON expression produced using Jettison based <code class="literal">mapped</code> notation</a></dt><dt>2.16. <a href="#d4e603">XML namespace to JSON mapping configuration for Jettison based <code class="literal">mapped</code> notation</a></dt><dt>2.17. <a href="#d4e607">JSON expression with XML namespaces mapped into JSON</a></dt><dt>2.18. <a href="#d4e620">JSON expression produced using <code class="literal">badgerfish</code> notation</a></dt><dt>2.19. <a href="#d4e635">JAXB bean creation</a></dt><dt>2.20. <a href="#d4e640">Constructing a JSONObject</a></dt></dl></div>
    
    <div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d4e4"></a>Preface</h2></div></div></div>
        
        <p>
This doc is yet in a very early state. We want to create here sort
of a user guide for jersey users, which will get versioned together 
with jersey code base. 
        </p>
        <p>
More content to come soon...
        </p>
    </div>
  
  <div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d4e8"></a>Chapter&nbsp;1.&nbsp;Overview of JAX-RS 1.0</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e15">1.1. Root Resource Classes</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e31">1.1.1. @Path</a></span></dt><dt><span class="section"><a href="#d4e56">1.1.2. HTTP Methods</a></span></dt><dt><span class="section"><a href="#d4e71">1.1.3. @Produces</a></span></dt><dt><span class="section"><a href="#d4e103">1.1.4. @Consumes</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e115">1.2. Deploying a RESTful Web Service</a></span></dt><dt><span class="section"><a href="#d4e147">1.3. Extracting Request Parameters</a></span></dt><dt><span class="section"><a href="#d4e221">1.4. Represetations and Java Types</a></span></dt><dt><span class="section"><a href="#d4e254">1.5. Building Responses</a></span></dt><dt><span class="section"><a href="#d4e271">1.6. Sub-resources</a></span></dt><dt><span class="section"><a href="#d4e302">1.7. Building URIs</a></span></dt><dt><span class="section"><a href="#d4e331">1.8. WebApplicationException and Mapping Exceptions to Responses</a></span></dt><dt><span class="section"><a href="#d4e361">1.9. Conditional GETs and Returning 304 (Not Modified) Responses</a></span></dt><dt><span class="section"><a href="#d4e379">1.10. Life-cycle of Root Resource Classes</a></span></dt><dt><span class="section"><a href="#d4e387">1.11. Security</a></span></dt><dt><span class="section"><a href="#d4e400">1.12. Rules of Injection</a></span></dt><dt><span class="section"><a href="#d4e412">1.13. Use of @Context</a></span></dt><dt><span class="section"><a href="#d4e424">1.14. Annotations Defined By JAX-RS</a></span></dt></dl></div>
  

  <p>This chapter presents an overview of the JAX-RS 1.0 features.</p>

  <p>The JAX-RS 1.0 API may be found online <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/index.html" target="_top">here</a>.</p>

  <p>The JAX-RS 1.0 specification may be found online <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/spec/index.html" target="_top">here</a>.</p>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e15"></a>1.1.&nbsp;Root Resource Classes</h2></div></div></div>
    

    <p><span class="emphasis"><em>Root resource classes</em></span> are POJOs (Plain Old Java
    Objects) that are annotated with <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
    have at least one method annotated with <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
    or a resource method designator annotation such as <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/GET.html" target="_top">@GET</a>,
    <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/PUT.html" target="_top">@PUT</a>,
    <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/POST.html" target="_top">@POST</a>,
    or <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/DELETE.html" target="_top">@DELETE</a>.
    Resource methods are methods of a resource class annotated with a resource
    method designator. This section shows how to use Jersey to annotate Java
    objects to create RESTful web services.</p>

    <p>The following code example is a very simple example of a root
    resource class using JAX-RS annotations. The example code shown here is
    from one of the samples that ships with Jersey, the zip file of which can
    be found in the maven repository <a class="ulink" href="http://download.java.net/maven/2/com/sun/jersey/samples/helloworld/1.0.3.1/helloworld-1.0.3.1-project.zip" target="_top">here</a>.</p>

    <div class="example"><a name="d4e28"></a><p class="title"><b>Example&nbsp;1.1.&nbsp;Simple hello world root resource class</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 package com.sun.ws.rest.samples.helloworld.resources;
&nbsp;&nbsp;2 
&nbsp;&nbsp;3 import javax.ws.rs.GET;
&nbsp;&nbsp;4 import javax.ws.rs.Produces;
&nbsp;&nbsp;5 import javax.ws.rs.Path;
&nbsp;&nbsp;6 
&nbsp;&nbsp;7 // The Java class will be hosted at the URI path "/helloworld"
&nbsp;&nbsp;8 @Path("/helloworld")
&nbsp;&nbsp;9 public class HelloWorldResource {
&nbsp;10 
&nbsp;11     // The Java method will process HTTP GET requests
&nbsp;12     @GET
&nbsp;13     // The Java method will produce content identified by the MIME Media
&nbsp;14     // type "text/plain"
&nbsp;15     @Produces("text/plain")
&nbsp;16     public String getClichedMessage() {
&nbsp;17         // Return some cliched textual content
&nbsp;18         return "Hello World";
&nbsp;19     }
&nbsp;20 }</pre></div></div><p><br class="example-break">Let's look at some of the JAX-RS annotations used in this
    example.</p>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e31"></a>1.1.1.&nbsp;@Path</h3></div></div></div>
      

      <p>The <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
      annotation's value is a relative URI path. In the example above, the
      Java class will be hosted at the URI path
      <code class="literal">/helloworld</code>. This is an extremely simple use of the
      <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
      annotation. What makes JAX-RS so useful is that you can embed variables
      in the URIs.</p>

      <p><span class="emphasis"><em>URI path templates</em></span> are URIs with variables
      embedded within the URI syntax. These variables are substituted at
      runtime in order for a resource to respond to a request based on the
      substituted URI. Variables are denoted by curly braces. For example,
      look at the following <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
      annotation:</p>

      <pre class="programlisting">@Path("/users/{username}")</pre><p>In this
      type of example, a user will be prompted to enter their name, and then a
      Jersey web service configured to respond to requests to this URI path
      template will respond. For example, if the user entered their username
      as "Galileo", the web service will respond to the following URL:</p>

      <p><code class="literal">http://example.com/users/Galileo</code></p>

      <p>To obtain the value of the username variable the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/PathParam.html" target="_top">@PathParam</a>
      may be used on method parameter of a request method, for example:</p>

      <div class="example"><a name="d4e47"></a><p class="title"><b>Example&nbsp;1.2.&nbsp;Specifying URI path parameter</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @Path("/users/{username}")
&nbsp;&nbsp;2 public class UserResource {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     @GET
&nbsp;&nbsp;5     @Produces("text/xml")
&nbsp;&nbsp;6     public String getUser(@PathParam("username") String userName) {
&nbsp;&nbsp;7         ...
&nbsp;&nbsp;8     }
&nbsp;&nbsp;9 }</pre></div></div><p><br class="example-break">If it is required that a user name must only consist of
      lower and upper case numeric characters then it is possible to declare a
      particular regular expression, which overrides the default regular
      expression, "[^/]+?", for example:</p>

      <pre class="programlisting">@Path("users/{username: [a-zA-Z][a-zA-Z_0-9]}")</pre><p>In
      this type of example the username variable will only match user names
      that begin with one upper or lower case letter and zero or more alpha
      numeric characters and the underscore character. If a user name does not
      match that a 404 (Not Found) response will occur. </p>

      <p>A <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
      value may or may not begin with a '/', it makes no difference. Likewise,
      by default, a <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
      value may or may not end in a '/', it makes no difference, and thus
      request URLs that end or do not end in a '/' will both be matched.
      However, Jersey has a redirection mechanism, which if enabled,
      automatically performs redirection to a request URL ending in a '/' if a
      request URL does not end in a '/' and the matching <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
      does end in a '/'.</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e56"></a>1.1.2.&nbsp;HTTP Methods</h3></div></div></div>
      

      <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/GET.html" target="_top">@GET</a>,
      <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/PUT.html" target="_top">@PUT</a>,
      <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/POST.html" target="_top">@POST</a>,
      <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/DELETE.html" target="_top">@DELETE</a>,
      and <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/HEAD.html" target="_top">@HEAD</a>
      are <span class="emphasis"><em>resource method designator</em></span> annotations defined
      by JAX-RS and which correspond to the similarly named HTTP methods. In
      the example above, the annotated Java method will process HTTP GET
      requests. The behavior of a resource is determined by which of the HTTP
      methods the resource is responding to.</p>

      <p>The following example is an extract from the storage service
      sample that shows the use of the PUT method to create or update a
      storage container:</p>

      <div class="example"><a name="d4e67"></a><p class="title"><b>Example&nbsp;1.3.&nbsp;PUT method</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @PUT
&nbsp;&nbsp;2 public Response putContainer() {
&nbsp;&nbsp;3     System.out.println("PUT CONTAINER " + container);
&nbsp;&nbsp;4 
&nbsp;&nbsp;5     URI uri =  uriInfo.getAbsolutePath();
&nbsp;&nbsp;6     Container c = new Container(container, uri.toString());
&nbsp;&nbsp;7 
&nbsp;&nbsp;8     Response r;
&nbsp;&nbsp;9     if (!MemoryStore.MS.hasContainer(c)) {
&nbsp;10         r = Response.created(uri).build();
&nbsp;11     } else {
&nbsp;12         r = Response.noContent().build();
&nbsp;13     }
&nbsp;14 
&nbsp;15     MemoryStore.MS.createContainer(c);
&nbsp;16     return r;
&nbsp;17 }</pre></div></div><p><br class="example-break">By default the JAX-RS runtime will automatically support the
      methods HEAD and OPTIONS, if not explicitly implemented. For HEAD the
      runtime will invoke the implemented GET method (if present) and ignore
      the response entity (if set). For OPTIONS the the Allow response header
      will be set to the set of HTTP methods support by the resource. In
      addition Jersey will return a <a class="ulink" href="https://wadl.dev.java.net/" target="_top">WADL</a> document describing the
      resource.</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e71"></a>1.1.3.&nbsp;@Produces</h3></div></div></div>
      

      <p>The <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Produces.html" target="_top">@Produces</a>
      annotation is used to specify the MIME media types of representations a
      resource can produce and send back to the client. In this example, the
      Java method will produce representations identified by the MIME media
      type "text/plain".</p>

      <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Produces.html" target="_top">@Produces</a>
      can be applied at both the class and method levels. Here's an
      example:</p>

      <div class="example"><a name="d4e78"></a><p class="title"><b>Example&nbsp;1.4.&nbsp;Specifying output MIME type</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @Path("/myResource")
&nbsp;&nbsp;2 @Produces("text/plain")
&nbsp;&nbsp;3 public class SomeResource {
&nbsp;&nbsp;4     @GET
&nbsp;&nbsp;5     public String doGetAsPlainText() {
&nbsp;&nbsp;6         ...
&nbsp;&nbsp;7     }
&nbsp;&nbsp;8 
&nbsp;&nbsp;9     @GET
&nbsp;10     @Produces("text/html")
&nbsp;11     public String doGetAsHtml() {
&nbsp;12         ...
&nbsp;13     }
&nbsp;14 }</pre></div></div><p><br class="example-break">The <code class="literal">doGetAsPlainText</code> method defaults to
      the MIME type of the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Produces.html" target="_top">@Produces</a>
      annotation at the class level. The <code class="literal">doGetAsHtml</code>
      method's <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Produces.html" target="_top">@Produces</a>
      annotation overrides the class-level <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Produces.html" target="_top">@Produces</a>
      setting, and specifies that the method can produce HTML rather than
      plain text. </p>

      <p>If a resource class is capable of producing more that one MIME
      media type then the resource method chosen will correspond to the most
      acceptable media type as declared by the client. More specifically the
      Accept header of the HTTP request declared what is most acceptable. For
      example if the Accept header is:</p>

      <pre class="programlisting">Accept: text/plain</pre><p>then the
      <code class="literal">doGetAsPlainText</code> method will be invoked.
      Alternatively if the Accept header is: </p>

      <pre class="programlisting">Accept: text/plain;q=0.9, text/html</pre>

      <p>which declares that the client can accept media types of
      "text/plain" and "text/html" but prefers the latter, then the
      <code class="literal">doGetAsHtml</code> method will be invoked. </p>

      <p>More than one media type may be declared in the same <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Produces.html" target="_top">@Produces</a>
      declaration, for example:</p>

      <div class="example"><a name="d4e97"></a><p class="title"><b>Example&nbsp;1.5.&nbsp;Using multiple output MIME types</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 @Produces({"application/xml", "application/json"})
&nbsp;&nbsp;3 public String doGetAsXmlOrJson() {
&nbsp;&nbsp;4     ...
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break">The <code class="literal">doGetAsXmlOrJson</code> method will get
      invoked if either of the media types "application/xml" and
      "application/json" are acceptable. If both are equally acceptable then
      the former will be chosen because it occurs first. </p>

      <p>The examples above refer explicitly to MIME media types for
      clarity. It is possible to refer to constant values, which may reduce
      typographical errors, see the constant field values of <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/MediaType.html" target="_top">MediaType</a>.</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e103"></a>1.1.4.&nbsp;@Consumes</h3></div></div></div>
      

      <p>The <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Consumes.html" target="_top">@Consumes</a>
      annotation is used to specify the MIME media types of representations a
      resource can consume that were sent by the client. The above example can
      be modified to set the cliched message as follows:</p>

      <div class="example"><a name="d4e108"></a><p class="title"><b>Example&nbsp;1.6.&nbsp;Specifying input MIME type</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("text/plain")
&nbsp;&nbsp;3 public void postClichedMessage(String message) {
&nbsp;&nbsp;4     // Store the message
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

      <p>In this example, the Java method will consume representations
      identified by the MIME media type "text/plain". Notice that the resource
      method returns void. This means no representation is returned and
      response with a status code of 204 (No Content) will be returned.</p>

      <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Consumes.html" target="_top">@Consumes</a>
      can be applied at both the class and method levels and more than one
      media type may be declared in the same <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Consumes.html" target="_top">@Consumes</a>
      declaration.</p>
    </div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e115"></a>1.2.&nbsp;Deploying a RESTful Web Service</h2></div></div></div>
    

    <p>JAX-RS provides the deployment agnostic abstract class <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Application.html" target="_top">Application</a>
    for declaring root resource classes and root resource singleton instances.
    A Web service may extend this class to declare root resource classes. For
    example,</p>

    <div class="example"><a name="d4e120"></a><p class="title"><b>Example&nbsp;1.7.&nbsp;Deployment agnostic application model</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 public class MyApplicaton extends Application {
&nbsp;&nbsp;2     public Set&lt;Class&lt;?&gt;&gt; getClasses() {
&nbsp;&nbsp;3         Set&lt;Class&lt;?&gt;&gt; s = new HashSet&lt;Class&lt;?&gt;&gt;();
&nbsp;&nbsp;4         s.add(HelloWorldResource.class);
&nbsp;&nbsp;5         return s;
&nbsp;&nbsp;6     }
&nbsp;&nbsp;7 }</pre></div></div><p><br class="example-break">Alternatively it is possible to reuse one of Jersey's
    implementations that scans for root resource classes given a classpath or
    a set of package names. Such classes are automatically added to the set of
    classes that are returned by <code class="literal">getClasses</code>. For example,
    the following scans for root resource classes in packages "org.foo.rest",
    "org.bar.rest" and in any sub-packages of those two:</p>

    <div class="example"><a name="d4e125"></a><p class="title"><b>Example&nbsp;1.8.&nbsp;Reusing Jersey implementation in your custom application model</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 public class MyApplication extends PackagesResourceConfig {
&nbsp;&nbsp;2     public MyApplication() {
&nbsp;&nbsp;3         super("org.foo.rest;org.bar.rest");
&nbsp;&nbsp;4     }
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>For servlet deployments JAX-RS specifies that a class that
    implements <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Application.html" target="_top">Application</a>
    may be declared instead of a servlet class in
    <code class="literal">&lt;servlet-class&gt;</code> element of a
    <code class="literal">web.xml</code>, but as of writing this is not currently
    supported for Jersey. Instead it is necessary to declare the Jersey
    specific servlet and the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Application.html" target="_top">Application</a>
    class as follows:</p>

    <div class="example"><a name="d4e134"></a><p class="title"><b>Example&nbsp;1.9.&nbsp;Deployment of your application using Jersey specific servlet</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 &lt;web-app&gt;
&nbsp;&nbsp;2     &lt;servlet&gt;
&nbsp;&nbsp;3         &lt;servlet-name&gt;Jersey Web Application&lt;/servlet-name&gt;
&nbsp;&nbsp;4         &lt;servlet-class&gt;com.sun.jersey.spi.container.servlet.ServletContainer&lt;/servlet-class&gt;
&nbsp;&nbsp;5         &lt;init-param&gt;
&nbsp;&nbsp;6             &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
&nbsp;&nbsp;7             &lt;param-value&gt;MyApplication&lt;/param-value&gt;
&nbsp;&nbsp;8         &lt;/init-param&gt;
&nbsp;&nbsp;9     &lt;/servlet&gt;
&nbsp;10     ....</pre></div></div><p><br class="example-break">Alternatively a simpler approach is to let Jersey
    choose the PackagesResourceConfig implementation automatically by
    declaring the packages as follows:</p>

    <div class="example"><a name="d4e138"></a><p class="title"><b>Example&nbsp;1.10.&nbsp;Using Jersey specific servlet without an application model instance</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 &lt;web-app&gt;
&nbsp;&nbsp;2     &lt;servlet&gt;
&nbsp;&nbsp;3         &lt;servlet-name&gt;Jersey Web Application&lt;/servlet-name&gt;
&nbsp;&nbsp;4         &lt;servlet-class&gt;com.sun.jersey.spi.container.servlet.ServletContainer&lt;/servlet-class&gt;
&nbsp;&nbsp;5         &lt;init-param&gt;
&nbsp;&nbsp;6             &lt;param-name&gt;com.sun.jersey.config.property.packages&lt;/param-name&gt;
&nbsp;&nbsp;7             &lt;param-value&gt;org.foo.rest;org.bar.rest&lt;/param-value&gt;
&nbsp;&nbsp;8         &lt;/init-param&gt;
&nbsp;&nbsp;9     &lt;/servlet&gt;
&nbsp;10     ....</pre></div></div><p><br class="example-break">JAX-RS also provides the ability to obtain a
    container specific artifact from an <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Application.html" target="_top">Application</a>
    instance. For example, Jersey supports using <a class="ulink" href="https://grizzly.dev.java.net/" target="_top">Grizzly</a> as follows:</p>

    <pre class="programlisting">SelectorThread st = RuntimeDelegate.createEndpoint(new MyApplication(), SelectorThread.class);</pre><p>Jersey
    also provides <a class="ulink" href="https://grizzly.dev.java.net/" target="_top">Grizzly</a>
    helper classes to deploy the ServletThread instance at a base URL for
    in-process deployment.</p>

    <p>The Jersey samples provide many examples of Servlet-based and
    Grizzly-in-process-based deployments.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e147"></a>1.3.&nbsp;Extracting Request Parameters</h2></div></div></div>
    

    <p>Parameters of a resource method may be annotated with
    parameter-based annotations to extract information from a request. A
    previous example presented the use <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/PathParam.html" target="_top">@PathParam</a>
    to extract a path parameter from the path component of the request URL
    that matched the path declared in <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>.</p>

    <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/QueryParam.html" target="_top">@QueryParam</a>
    is used to extract query parameters from the Query component of the
    request URL. The following example is an extract from the sparklines
    sample: </p>

    <div class="example"><a name="d4e154"></a><p class="title"><b>Example&nbsp;1.11.&nbsp;Query parameters</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @Path("smooth")
&nbsp;&nbsp;2 @GET
&nbsp;&nbsp;3 public Response smooth(
&nbsp;&nbsp;4         @DefaultValue("2") @QueryParam("step") int step,
&nbsp;&nbsp;5         @DefaultValue("true") @QueryParam("min-m") boolean hasMin,
&nbsp;&nbsp;6         @DefaultValue("true") @QueryParam("max-m") boolean hasMax,
&nbsp;&nbsp;7         @DefaultValue("true") @QueryParam("last-m") boolean hasLast,           
&nbsp;&nbsp;8         @DefaultValue("blue") @QueryParam("min-color") ColorParam minColor,
&nbsp;&nbsp;9         @DefaultValue("green") @QueryParam("max-color") ColorParam maxColor,
&nbsp;10         @DefaultValue("red") @QueryParam("last-color") ColorParam lastColor
&nbsp;11         ) { ... }</pre></div></div><br class="example-break">

    <p>If a query parameter "step" exists in the query component of the
    request URI then the "step" value will be will extracted and parsed as a
    32 bit signed integer and assigned to the step method parameter. If "step"
    does not exist then a default value of 2, as declared in the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/DefaultValue.html" target="_top">@DefaultValue</a>
    annotation, will be assigned to the step method parameter. If the "step"
    value cannot be parsed as an 32 bit signed integer then a 400 (Client
    Error) response is returned. User defined Java types such as
    <code class="literal">ColorParam</code> may be used, which as implemented as
    follows: </p>

    <div class="example"><a name="d4e160"></a><p class="title"><b>Example&nbsp;1.12.&nbsp;Custom Java type for consuming request parameters</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 public class ColorParam extends Color {
&nbsp;&nbsp;2     public ColorParam(String s) {
&nbsp;&nbsp;3         super(getRGB(s));
&nbsp;&nbsp;4     }
&nbsp;&nbsp;5 
&nbsp;&nbsp;6     private static int getRGB(String s) {
&nbsp;&nbsp;7         if (s.charAt(0) == '#') {
&nbsp;&nbsp;8             try {
&nbsp;&nbsp;9                 Color c = Color.decode("0x" + s.substring(1));
&nbsp;10                 return c.getRGB();
&nbsp;11             } catch (NumberFormatException e) {
&nbsp;12                 throw new WebApplicationException(400);
&nbsp;13             }
&nbsp;14         } else {
&nbsp;15             try {
&nbsp;16                 Field f = Color.class.getField(s);
&nbsp;17                 return ((Color)f.get(null)).getRGB();
&nbsp;18             } catch (Exception e) {
&nbsp;19                 throw new WebApplicationException(400);
&nbsp;20             }
&nbsp;21         }
&nbsp;22     }
&nbsp;23 }</pre></div></div><br class="example-break">

    <p>In general the Java type of the method parameter may:</p>

    <div class="orderedlist"><ol type="1"><li>
        <p>Be a primitive type;</p>
      </li><li>
        <p>Have a constructor that accepts a single
        <code class="literal">String</code> argument;</p>
      </li><li>
        <p>Have a static method named <code class="literal">valueOf</code> that
        accepts a single <code class="literal">String</code> argument (see, for example,
        <code class="literal">Integer.valueOf(String)</code>); or</p>
      </li><li>
        <p>Be <code class="literal">List&lt;T&gt;</code>,
        <code class="literal">Set&lt;T&gt;</code> or
        <code class="literal">SortedSet&lt;T&gt;</code>, where <code class="literal">T</code>
        satisfies 2 or 3 above. The resulting collection is read-only.</p>
      </li></ol></div>

    <p>Sometimes parameters may contain more than one value for the same
    name. If this is the case then types in 4) may be used to obtain all
    values.</p>

    <p>If the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/DefaultValue.html" target="_top">@DefaultValue</a>
    is not used on conjuction with <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/QueryParam.html" target="_top">@QueryParam</a>
    and the query parameter is not present in the request then value will be
    an empty collection for <code class="literal">List</code>, <code class="literal">Set</code> or
    <code class="literal">SortedSet</code>, <code class="literal">null</code> for other object
    types, and the Java-defined default for primitive types.</p>

    <p>The <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/PathParam.html" target="_top">@PathParam</a>
    and the other parameter-based annotations, <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/MatrixParam.html" target="_top">@MatrixParam</a>,
    <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/HeaderParam.html" target="_top">@HeaderParam</a>,
    <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/CookieParam.html" target="_top">@CookieParam</a>
    and <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/FormParam.html" target="_top">@FormParam</a>
    obey the same rules as <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/QueryParam.html" target="_top">@QueryParam</a>.
    <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/MatrixParam.html" target="_top">@MatrixParam</a>
    extracts information from URL path segments. <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/HeaderParam.html" target="_top">@HeaderParam</a>
    extracts information from the HTTP headers. <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/CookieParam.html" target="_top">@CookieParam</a>
    extracts information from the cookies declared in cookie related HTTP
    headers.</p>

    <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/FormParam.html" target="_top">@FormParam</a>
    is slightly special because it extracts information from a request
    representation that is of the MIME media type
    "application/x-www-form-urlencoded" and conforms to the encoding specified
    by HTML forms, as described here. This parameter is very useful for
    extracting information that is POSTed by HTML forms, for example the
    following extracts the form parameter named "name" from the POSTed form
    data: </p>

    <div class="example"><a name="d4e202"></a><p class="title"><b>Example&nbsp;1.13.&nbsp;Processing POSTed HTML form</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("application/x-www-form-urlencoded")
&nbsp;&nbsp;3 public void post(@FormParam("name") String name) {
&nbsp;&nbsp;4     // Store the message
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>If it is necessary to obtain a general map of parameter name to
    values then, for query and path parameters it is possible to do the
    following: </p>

    <div class="example"><a name="d4e207"></a><p class="title"><b>Example&nbsp;1.14.&nbsp;Obtaining general map of URI path and/or query parameters</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 public String get(@Context UriInfo ui) {
&nbsp;&nbsp;3     MultivaluedMap&lt;String, String&gt; queryParams = ui.getQueryParameters();
&nbsp;&nbsp;4     MultivaluedMap&lt;String, String&gt; pathParams = ui.getPathParameters();
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>For header and cookie parameters the following:</p>

    <div class="example"><a name="d4e212"></a><p class="title"><b>Example&nbsp;1.15.&nbsp;Obtaining general map of header parameters</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 public String get(@Context HttpHeaders hh) {
&nbsp;&nbsp;3     MultivaluedMap&lt;String, String&gt; headerParams = ui.getRequestHeaders();
&nbsp;&nbsp;4     Map&lt;String, Cookie&gt; pathParams = ui.getCookies();
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>In general <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Context.html" target="_top">@Context</a>
    can be used to obtain contextual Java types related to the request or
    response. For form parameters it is possible to do the following:</p>

    <div class="example"><a name="d4e218"></a><p class="title"><b>Example&nbsp;1.16.&nbsp;Obtaining general map of form parameters</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("application/x-www-form-urlencoded")
&nbsp;&nbsp;3 public void post(MultivaluedMap&lt;String, String&gt; formParams) {
&nbsp;&nbsp;4     // Store the message
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e221"></a>1.4.&nbsp;Represetations and Java Types</h2></div></div></div>
    

    <p>Previous sections on <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Produces.html" target="_top">@Produces</a>
    and <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Consumes.html" target="_top">@Consumes</a>
    referred to MIME media types of representations and showed resource
    methods that consume and produce the Java type String for a number of
    different media types. However, <code class="literal">String</code> is just one of
    many Java types that are required to be supported by JAX-RS
    implementations.</p>

    <p>Java types such as <code class="literal">byte[]</code>,
    <code class="literal">java.io.InputStream</code>, <code class="literal">java.io.Reader</code>
    and <code class="literal">java.io.File</code> are supported. In addition JAXB beans
    are supported. Such beans are <code class="literal">JAXBElement</code> or classes
    annotated with <a class="ulink" href="http://java.sun.com/javase/6/docs/api/javax/xml/bind/annotation/XmlRootElement.html" target="_top">@XmlRootElement</a>
    or <a class="ulink" href="http://java.sun.com/javase/6/docs/api/javax/xml/bind/annotation/XmlType.html" target="_top">@XmlType</a>.
    The samples jaxb and json-from-jaxb show the use of JAXB beans. </p>

    <p>Unlike method parameters that are associated with the extraction of
    request parameters, the method parameter associated with the
    representation being consumed does not require annotating. A maximum of
    one such unannotated method parameter may exist since there may only be a
    maximum of one such representation sent in a request.</p>

    <p>The representation being produced corresponds to what is returned by
    the resource method. For example JAX-RS makes it simple to produce images
    that are instance of <code class="literal">File</code> as follows:</p>

    <div class="example"><a name="d4e239"></a><p class="title"><b>Example&nbsp;1.17.&nbsp;Using <code class="code">File</code> with a specific MIME type to produce a response</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 @Path("/images/{image}")
&nbsp;&nbsp;3 @Produces("image/*")
&nbsp;&nbsp;4 public Response getImage(@PathParam("image") String image) {
&nbsp;&nbsp;5     File f = new File(image);
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     if (!f.exists()) {
&nbsp;&nbsp;8         throw new WebApplicationException(404);
&nbsp;&nbsp;9     }
&nbsp;10 
&nbsp;11     String mt = new MimetypesFileTypeMap().getContentType(f);
&nbsp;12     return Response.ok(f, mt).build();
&nbsp;13 }</pre></div></div><p><br class="example-break"></p>

    <p>A <code class="literal">File</code> type can also be used when consuming, a
    temporary file will be created where the request entity is stored.</p>

    <p>The <code class="literal">Content-Type</code> (if not set, see next section)
    can be automatically set from the MIME media types declared by <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Produces.html" target="_top">@Produces</a>
    if the most acceptable media type is not a wild card (one that contains a
    *, for example "application/" or "/*"). Given the following method:</p>

    <div class="example"><a name="d4e249"></a><p class="title"><b>Example&nbsp;1.18.&nbsp;The most acceptable MIME type is used when multiple output MIME types allowed</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 @Produces({"application/xml", "application/json"})
&nbsp;&nbsp;3 public String doGetAsXmlOrJson() {
&nbsp;&nbsp;4     ...
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>if "application/xml" is the most acceptable then the
    <code class="literal">Content-Type</code> of the response will be set to
    "application/xml".</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e254"></a>1.5.&nbsp;Building Responses</h2></div></div></div>
    

    <p>Sometimes it is necessary to return additional
    information in response to a HTTP request. Such information may be built
    and returned using <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Response.html" target="_top">Response</a>
    and <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Response.ResponseBuilder.html" target="_top">Response.ResponseBuilder</a>.
    For example, a common RESTful pattern for the creation of a new resource
    is to support a POST request that returns a 201 (Created) status code and
    a <code class="literal">Location</code> header whose value is the URI to the newly
    created resource. This may be acheived as follows:</p>

    <div class="example"><a name="d4e261"></a><p class="title"><b>Example&nbsp;1.19.&nbsp;Returning 201 status code and adding <code class="literal">Location</code> header in response to POST request</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("application/xml")
&nbsp;&nbsp;3 public Response post(String content) {
&nbsp;&nbsp;4     URI createdUri = ...
&nbsp;&nbsp;5     create(content);
&nbsp;&nbsp;6     return Response.created(createdUri).build();
&nbsp;&nbsp;7 }</pre></div></div><p><br class="example-break"></p>

    <p>In the above no representation produced is returned, this can be
    achieved by building an entity as part of the response as follows:</p>

    <div class="example"><a name="d4e267"></a><p class="title"><b>Example&nbsp;1.20.&nbsp;Adding an entity body to a custom response</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("application/xml")
&nbsp;&nbsp;3 public Response post(String content) {
&nbsp;&nbsp;4     URI createdUri = ...
&nbsp;&nbsp;5     String createdContent = create(content);
&nbsp;&nbsp;6     return Response.created(createdUri).entity(createdContent).build();
&nbsp;&nbsp;7 }</pre></div></div><p><br class="example-break"></p>

    <p>Response building provides other functionality such as setting the
    entity tag and last modified date of the representation.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e271"></a>1.6.&nbsp;Sub-resources</h2></div></div></div>
    

    <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
    may be used on classes and such classes are referred to as root resource
    classes. <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
    may also be used on methods of root resource classes. This enables common
    functionality for a number of resources to be grouped together and
    potentially reused.</p>

    <p>The first way <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
    may be used is on resource methods and such methods are referred to as
    <span class="emphasis"><em>sub-resource methods</em></span>. The following example shows the
    method signatures for a root resource class from the jmaki-backend
    sample:</p>

    <div class="example"><a name="d4e280"></a><p class="title"><b>Example&nbsp;1.21.&nbsp;Sub-resource methods</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Singleton
&nbsp;&nbsp;2 @Path("/printers")
&nbsp;&nbsp;3 public class PrintersResource {
&nbsp;&nbsp;4 
&nbsp;&nbsp;5     @GET
&nbsp;&nbsp;6     @Produces({"application/json", "application/xml"})
&nbsp;&nbsp;7     public WebResourceList getMyResources() { ... }
&nbsp;&nbsp;8    
&nbsp;&nbsp;9     @GET @Path("/list")
&nbsp;10     @Produces({"application/json", "application/xml"})
&nbsp;11     public WebResourceList getListOfPrinters() { ... }
&nbsp;12 
&nbsp;13     @GET @Path("/jMakiTable")
&nbsp;14     @Produces("application/json")
&nbsp;15     public PrinterTableModel getTable() { ... }
&nbsp;16 
&nbsp;17     @GET @Path("/jMakiTree")
&nbsp;18     @Produces("application/json")
&nbsp;19     public TreeModel getTree() { ... }
&nbsp;20 
&nbsp;21     @GET @Path("/ids/{printerid}")
&nbsp;22     @Produces({"application/json", "application/xml"})
&nbsp;23     public Printer getPrinter(@PathParam("printerid") String printerId) { ... }
&nbsp;24 
&nbsp;25     @PUT @Path("/ids/{printerid}")
&nbsp;26     @Consumes({"application/json", "application/xml"})
&nbsp;27     public void putPrinter(@PathParam("printerid") String printerId,  Printer printer) { ... }
&nbsp;28 
&nbsp;29     @DELETE @Path("/ids/{printerid}")
&nbsp;30     public void deletePrinter(@PathParam("printerid") String printerId) { ... }
&nbsp;31 }</pre></div></div><p><br class="example-break"></p>

    <p>If the path of the request URL is "printers" then the resource
    methods not annotated with <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
    will be selected. If the request path of the request URL is
    "printers/list" then first the root resource class will be matched and
    then the sub-resource methods that match "list" will be selected, which in
    this case is the sub-resource method <code class="literal">getListOfPrinters</code>.
    So in this example hierarchical matching on the path of the request URL is
    performed.</p>

    <p>The second way <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/Path.html" target="_top">@Path</a>
    may be used is on methods <span class="bold"><strong>not</strong></span> annotated
    with resource method designators such as <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/GET.html" target="_top">@GET</a>
    or <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/POST.html" target="_top">@POST</a>.
    Such methods are referred to as <span class="emphasis"><em>sub-resource
    locators</em></span>. The following example shows the method signatures for
    a root resource class and a resource class from the optimistic-concurrency
    sample:</p>

    <div class="example"><a name="d4e293"></a><p class="title"><b>Example&nbsp;1.22.&nbsp;Sub-resource locators</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("/item")
&nbsp;&nbsp;2 public class ItemResource {
&nbsp;&nbsp;3     @Context UriInfo uriInfo;
&nbsp;&nbsp;4 
&nbsp;&nbsp;5     @Path("content")
&nbsp;&nbsp;6     public ItemContentResource getItemContentResource() {
&nbsp;&nbsp;7         return new ItemContentResource();
&nbsp;&nbsp;8     }
&nbsp;&nbsp;9 
&nbsp;10     @GET
&nbsp;11     @Produces("application/xml")
&nbsp;12     public Item get() { ... }
&nbsp;13 }
&nbsp;14 
&nbsp;15 public class ItemContentResource {
&nbsp;16 
&nbsp;17     @GET
&nbsp;18     public Response get() { ... }
&nbsp;19 
&nbsp;20     @PUT
&nbsp;21     @Path("{version}")
&nbsp;22     public void put(
&nbsp;23             @PathParam("version") int version,
&nbsp;24             @Context HttpHeaders headers,
&nbsp;25             byte[] in) { ... }
&nbsp;26 }</pre></div></div><p><br class="example-break"></p>

    <p>The root resource class <code class="literal">ItemResource</code> contains the
    sub-resource locator method <code class="literal">getItemContentResource</code> that
    returns a new resource class. If the path of the request URL is
    "item/content" then first of all the root resource will be matched, then
    the sub-resource locator will be matched and invoked, which returns an
    instance of the <code class="literal">ItemContentResource</code> resource class.
    Sub-resource locators enable reuse of resource classes.</p>

    <p>In addition the processing of resource classes returned by
    sub-resource locators is performed at runtime thus it is possible to
    support polymorphism. A sub-resource locator may return different
    sub-types depending on the request (for example a sub-resource locator
    could return different sub-types dependent on the role of the principle
    that is authenticated).</p>

    <p>Note that the runtime will not manage the life-cycle or perform any
    field injection onto instances returned from sub-resource locator methods.
    This is because the runtime does not know what the life-cycle of the
    instance is.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e302"></a>1.7.&nbsp;Building URIs</h2></div></div></div>
    

    <p>A very important aspects of REST is hyperlinks, URIs, in
    representations that clients can use to transition the Web service to new
    application states (this is otherwise known as "hypermedia as the engine
    of application state"). HTML forms present a good example of this in
    practice.</p>

    <p>Building URIs and building them safely is not easy with <a class="ulink" href="http://java.sun.com/j2se/1.5.0/docs/api/java/net/URI.html" target="_top">java.net.URI</a>,
    which is why JAX-RS has the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a>
    class that makes it simple and easy to build URIs safely.</p>

    <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a>
    can be used to build new URIs or build from existing URIs. For resource
    classes it is more than likely that URIs will be built from the base URI
    the Web service is deployed at or from the request URI. The class <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriInfo.html" target="_top">UriInfo</a>
    provides such information (in addition to further information, see next
    section).</p>

    <p>The following example shows URI building with UriInfo and <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a>
    from the bookmark sample:</p>

    <div class="example"><a name="d4e314"></a><p class="title"><b>Example&nbsp;1.23.&nbsp;URI building</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("/users/")
&nbsp;&nbsp;2 public class UsersResource {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     @Context UriInfo uriInfo;
&nbsp;&nbsp;5 
&nbsp;&nbsp;6     ...
&nbsp;&nbsp;7 
&nbsp;&nbsp;8     @GET
&nbsp;&nbsp;9     @Produces("application/json")
&nbsp;10     public JSONArray getUsersAsJsonArray() {
&nbsp;11         JSONArray uriArray = new JSONArray();
&nbsp;12         for (UserEntity userEntity : getUsers()) {
&nbsp;13             UriBuilder ub = uriInfo.getAbsolutePathBuilder();
&nbsp;14             URI userUri = ub.
&nbsp;15                     path(userEntity.getUserid()).
&nbsp;16                     build();
&nbsp;17             uriArray.put(userUri.toASCIIString());
&nbsp;18         }
&nbsp;19         return uriArray;
&nbsp;20     }
&nbsp;21 }</pre></div></div><p><br class="example-break"></p>

    <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriInfo.html" target="_top">UriInfo</a>
    is obtained using the @Context annotation, and in this particular example
    injection onto the field of the root resource class is performed, previous
    examples showed the use of @Context on resource method parameters.</p>

    <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriInfo.html" target="_top">UriInfo</a>
    can be used to obtain URIs and associated <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a>
    instances for the following URIs: the base URI the application is deployed
    at; the request URI; and the absolute path URI, which is the request URI
    minus any query components.</p>

    <p>The <code class="literal">getUsersAsJsonArray</code> method constructs a
    JSONArrray where each element is a URI identifying a specific user
    resource. The URI is built from the absolute path of the request URI by
    calling <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriInfo.html#getAbsolutePathBuilder()" target="_top">uriInfo.getAbsolutePathBuilder()</a>.
    A new path segment is added, which is the user ID, and then the URI is
    built. Notice that it is not necessary to worry about the inclusion of '/'
    characters or that the user ID may contain characters that need to be
    percent encoded. UriBuilder takes care of such details.</p>

    <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a>
    can be used to build/replace query or matrix parameters. URI templates can
    also be declared, for example the following will build the URI
    "http://localhost/segment?name=value":</p>

    <div class="example"><a name="d4e328"></a><p class="title"><b>Example&nbsp;1.24.&nbsp;Building URIs using query parameters</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 UriBuilder.fromUri("http://localhost/").
&nbsp;&nbsp;2     path("{a}").
&nbsp;&nbsp;3     queryParam("name", "{value}").
&nbsp;&nbsp;4     build("segment", "value");</pre></div></div><p><br class="example-break"></p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e331"></a>1.8.&nbsp;WebApplicationException and Mapping Exceptions to Responses</h2></div></div></div>
    

    <p>Previous sections have shown how to return HTTP responses and it is
    possible to return HTTP errors using the same mechanism. However,
    sometimes when programming in Java it is more natural to use exceptions
    for HTTP errors.</p>

    <p>The following example shows the throwing of a
    <code class="literal">NotFoundException</code> from the bookmark sample:</p>

    <div class="example"><a name="d4e337"></a><p class="title"><b>Example&nbsp;1.25.&nbsp;Throwing Jersey specific exceptions to control response</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("items/{itemid}/")
&nbsp;&nbsp;2 public Item getItem(@PathParam("itemid") String itemid) {
&nbsp;&nbsp;3     Item i = getItems().get(itemid);
&nbsp;&nbsp;4     if (i == null)
&nbsp;&nbsp;5         throw new NotFoundException("Item, " + itemid + ", is not found");
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     return i;
&nbsp;&nbsp;8 }</pre></div></div><p><br class="example-break"></p>

    <p>This exception is a Jersey specific exception that extends <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/WebApplicationException.html" target="_top">WebApplicationException</a>
    and builds a HTTP response with the 404 status code and an optional
    message as the body of the response:</p>

    <div class="example"><a name="d4e343"></a><p class="title"><b>Example&nbsp;1.26.&nbsp;Jersey specific exception implementation</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 public class NotFoundException extends WebApplicationException {
&nbsp;&nbsp;2 
&nbsp;&nbsp;3     /**
&nbsp;&nbsp;4      * Create a HTTP 404 (Not Found) exception.
&nbsp;&nbsp;5      */
&nbsp;&nbsp;6     public NotFoundException() {
&nbsp;&nbsp;7         super(Responses.notFound().build());
&nbsp;&nbsp;8     }
&nbsp;&nbsp;9 
&nbsp;10     /**
&nbsp;11      * Create a HTTP 404 (Not Found) exception.
&nbsp;12      * @param message the String that is the entity of the 404 response.
&nbsp;13      */
&nbsp;14     public NotFoundException(String message) {
&nbsp;15         super(Response.status(Responses.NOT_FOUND).
&nbsp;16                 entity(message).type("text/plain").build());
&nbsp;17     }
&nbsp;18 
&nbsp;19 }</pre></div></div><p><br class="example-break"></p>

    <p>In other cases it may not be appropriate to throw instances of
    <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/WebApplicationException.html" target="_top">WebApplicationException</a>,
    or classes that extend <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/WebApplicationException.html" target="_top">WebApplicationException</a>,
    and instead it may be preferable to map an existing exception to a
    response. For such cases it is possible to use the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/ext/ExceptionMapper.html" target="_top">ExceptionMapper</a>
    interface. For example, the following maps the <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityNotFoundException.html" target="_top">EntityNotFoundException</a>
    to a 404 (Not Found) response:</p>

    <div class="example"><a name="d4e352"></a><p class="title"><b>Example&nbsp;1.27.&nbsp;Mapping generic exceptions to responses</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Provider
&nbsp;&nbsp;2 public class EntityNotFoundMapper implements
&nbsp;&nbsp;3         ExceptionMapper&lt;javax.persistence.EntityNotFoundException&gt; {
&nbsp;&nbsp;4     public Response toResponse(javax.persistence.EntityNotFoundException ex) {
&nbsp;&nbsp;5         return Response.status(404).
&nbsp;&nbsp;6             entity(ex.getMessage()).
&nbsp;&nbsp;7             type("text/plain").
&nbsp;&nbsp;8             build();
&nbsp;&nbsp;9     }
&nbsp;10 }</pre></div></div><p><br class="example-break"></p>

    <p>The above class is annotated with <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/ext/Provider.html" target="_top">@Provider</a>,
    this declares that the class is of interest to the JAX-RS runtime. Such a
    class may be added to the set of classes of the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Application.html" target="_top">Application</a>
    instance that is configured. When an application throws an <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityNotFoundException.html" target="_top">EntityNotFoundException</a>
    the <code class="literal">toResponse</code> method of the
    <code class="literal">EntityNotFoundMapper</code> instance will be invoked.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e361"></a>1.9.&nbsp;Conditional GETs and Returning 304 (Not Modified) Responses</h2></div></div></div>
    

    <p>Conditional GETs are a great way to reduce bandwidth, and
    potentially server-side peformance, depending on how the information used
    to determine conditions is calculated. A well-designed web site may return
    304 (Not Modified) responses for the many of the static images it
    serves.</p>

    <p>JAX-RS provides support for conditional GETs using the contextual
    interface <a class="ulink" href="https://jsr311.dev.java.net/nonav/javadoc/javax/ws/rs/core/Request.html" target="_top">Request</a>.</p>

    <p>The following example shows conditional GET support from the
    sparklines sample: </p>

    <div class="example"><a name="d4e368"></a><p class="title"><b>Example&nbsp;1.28.&nbsp;Conditional GET support</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 public SparklinesResource(
&nbsp;&nbsp;2         @QueryParam("d") IntegerList data,
&nbsp;&nbsp;3         @DefaultValue("0,100") @QueryParam("limits") Interval limits,
&nbsp;&nbsp;4         @Context Request request,
&nbsp;&nbsp;5         @Context UriInfo ui) {
&nbsp;&nbsp;6     if (data == null)
&nbsp;&nbsp;7         throw new WebApplicationException(400);
&nbsp;&nbsp;8 
&nbsp;&nbsp;9     this.data = data;
&nbsp;10 
&nbsp;11     this.limits = limits;
&nbsp;12 
&nbsp;13     if (!limits.contains(data))
&nbsp;14         throw new WebApplicationException(400);
&nbsp;15 
&nbsp;16     this.tag = computeEntityTag(ui.getRequestUri());
&nbsp;17     if (request.getMethod().equals("GET")) {
&nbsp;18         Response.ResponseBuilder rb = request.evaluatePreconditions(tag);
&nbsp;19         if (rb != null)
&nbsp;20             throw new WebApplicationException(rb.build());
&nbsp;21     }
&nbsp;22 }</pre></div></div><p><br class="example-break"></p>

    <p>The constructor of the <code class="literal">SparklinesResouce</code> root
    resource class computes an entity tag from the request URI and then calls
    the <a class="ulink" href="https://jsr311.dev.java.net/nonav/javadoc/javax/ws/rs/core/Request.html#evaluatePreconditions(javax.ws.rs.core.EntityTag)" target="_top">request.evaluatePreconditions</a>
    with that entity tag. If a client request contains an
    <code class="literal">If-None-Match</code> header with a value that contains the
    same entity tag that was calculated then the <a class="ulink" href="https://jsr311.dev.java.net/nonav/javadoc/javax/ws/rs/core/Request.html#evaluatePreconditions(javax.ws.rs.core.EntityTag)" target="_top">evaluatePreconditions</a>
    returns a pre-filled out response, with the 304 status code and entity tag
    set, that may be built and returned. Otherwise, <a class="ulink" href="https://jsr311.dev.java.net/nonav/javadoc/javax/ws/rs/core/Request.html#evaluatePreconditions(javax.ws.rs.core.EntityTag)" target="_top">evaluatePreconditions</a>
    returns <code class="literal">null</code> and the normal response can be
    returned.</p>

    <p>Notice that in this example the constructor of a resource class can
    be used perform actions that may otherwise have to be duplicated to
    invoked for each resource method.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e379"></a>1.10.&nbsp;Life-cycle of Root Resource Classes</h2></div></div></div>
    

    <p>By default the life-cycle of root resource classes is per-request,
    namely that a new instance of a root resource class is created every time
    the request URI path matches the root resource. This makes for a very
    natural programming model where constructors and fields can be utilized
    (as in the previous section showing the constructor of the
    <code class="literal">SparklinesResource</code> class) without concern for multiple
    concurrent requests to the same resource.</p>

    <p>In general this is unlikely to be a cause of performance issues.
    Class construction and garbage collection of JVMs has vastly improved over
    the years and many objects will be created and discarded to serve and
    process the HTTP request and return the HTTP response.</p>

    <p>Instances of singleton root resource classes can be declared by an
    instance of <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Application.html" target="_top">Application</a>.</p>

    <p>Jersey supports two further life-cycles using Jersey specific
    annotations. If a root resource class is annotated with @Singleton then
    only one instance is created per-web applcation. If a root resource class
    is annotated with @PerSession then one instance is created per web session
    and stored as a session attribute.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e387"></a>1.11.&nbsp;Security</h2></div></div></div>
    

    <p>Security information is available by obtaining the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/SecurityContext.html" target="_top">SecurityContext</a>
    using <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Context.html" target="_top">@Context</a>,
    which is essentially the equivalent functionality available on the <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletRequest.html" target="_top">HttpServletRequest</a>.</p>

    <p><a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/SecurityContext.html" target="_top">SecurityContext</a>
    can be used in conjunction with sub-resource locators to return different
    resources if the user principle is included in a certain role. For
    example, a sub-resource locator could return a different resource if a
    user is a preferred customer:</p>

    <div class="example"><a name="d4e396"></a><p class="title"><b>Example&nbsp;1.29.&nbsp;Accessing <code class="code">SecurityContext</code></b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("basket")
&nbsp;&nbsp;2 public ShoppingBasketResource get(@Context SecurityContext sc) {
&nbsp;&nbsp;3     if (sc.isUserInRole("PreferredCustomer") {
&nbsp;&nbsp;4        return new PreferredCustomerShoppingBaskestResource();
&nbsp;&nbsp;5     } else {
&nbsp;&nbsp;6        return new ShoppingBasketResource();
&nbsp;&nbsp;7     }
&nbsp;&nbsp;8 }</pre></div></div><p><br class="example-break"></p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e400"></a>1.12.&nbsp;Rules of Injection</h2></div></div></div>
    

    <p>Previous sections have presented examples of annotated types, mostly
    annotated method parameters but also annotated fields of a class, for the
    injection of values onto those types.</p>

    <p>This section presents the rules of injection of values on annotated
    types. Injection can be performed on fields, constructor parameters,
    resource/sub-resource/sub-resource locator method parameters and bean
    setter methods. The following presents an example of all such injection
    cases: </p>

    <div class="example"><a name="d4e405"></a><p class="title"><b>Example&nbsp;1.30.&nbsp;Injection</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("id: \d+")
&nbsp;&nbsp;2 public class InjectedResource {
&nbsp;&nbsp;3     // Injection onto field
&nbsp;&nbsp;4     @DefaultValue("q") @QueryParam("p")
&nbsp;&nbsp;5     private String p;
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     // Injection onto constructor parameter
&nbsp;&nbsp;8     public InjectedResource(@PathParam("id") int id) { ... }
&nbsp;&nbsp;9 
&nbsp;10     // Injection onto resource method parameter
&nbsp;11     @GET
&nbsp;12     public String get(@Context UriInfo ui) { ... }
&nbsp;13 
&nbsp;14     // Injection onto sub-resource resource method parameter
&nbsp;15     @Path("sub-id")
&nbsp;16     @GET
&nbsp;17     public String get(@PathParam("sub-id") String id) { ... }
&nbsp;18 
&nbsp;19     // Injection onto sub-resource locator method parameter
&nbsp;20     @Path("sub-id")
&nbsp;21     public SubResource getSubResource(@PathParam("sub-id") String id) { ... }
&nbsp;22 
&nbsp;23     // Injection using bean setter method
&nbsp;24     @HeaderParam("X-header")
&nbsp;25     public void setHeader(String header) { ... }
&nbsp;26 }</pre></div></div><p><br class="example-break"></p>

    <p>There are some restrictions when injecting on to resource classes
    with a life-cycle other than per-request. In such cases it is not possible
    to injected onto fields for the annotations associated with extraction of
    request parameters. However, it is possible to use the <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Context.html" target="_top">@Context</a>
    annotation on fields, in such cases a thread local proxy will be
    injected.</p>

    <p>The <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/FormParam.html" target="_top">@FormParam</a>
    annotation is special and may only be utilized on resource and
    sub-resource methods. This is because it extracts information from a
    request entity.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e412"></a>1.13.&nbsp;Use of @Context</h2></div></div></div>
    

    <p>Previous sections have introduced the use of <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Context.html" target="_top">@Context</a>.
    <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/spec/spec3.html#x3-520005" target="_top">Chapter
    5</a> of the JAX-RS specification presents all the standard JAX-RS
    Java types that may be used with <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Context.html" target="_top">@Context</a>.</p>

    <p>When deploying a JAX-RS application using servlet then <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletConfig.html" target="_top">ServletConfig</a>,
    <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletContext.html" target="_top">ServletContext</a>,
    <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletRequest.html" target="_top">HttpServletRequest</a>
    and <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletResponse.html" target="_top">HttpServletResponse</a>
    are available using <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/core/Context.html" target="_top">@Context</a>.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e424"></a>1.14.&nbsp;Annotations Defined By JAX-RS</h2></div></div></div>
    

    <p>For a list of the annotations specified by JAX-RS see <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/spec/index.html" target="_top">Appendix
    A</a> of the specification.</p>
  </div>
</div>
  <div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="json"></a>Chapter&nbsp;2.&nbsp;JSON Support</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e442">2.1. JAXB Based JSON support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e457">2.1.1. Configuration Options</a></span></dt><dt><span class="section"><a href="#d4e478">2.1.2. JSON Notations</a></span></dt><dt><span class="section"><a href="#d4e624">2.1.3. Examples</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e629">2.2. Low-Level JSON support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e643">2.2.1. Examples</a></span></dt></dl></dd></dl></div>
  

  <p>Jersey JSON support comes as a set of JAX-RS <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/ext/MessageBodyReader.html" target="_top">MessageBodyReader</a>
  and <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/ext/MessageBodyWriter.html" target="_top">MessageBodyWriter</a>
  providers distributed with <span class="emphasis"><em>jersey-json</em></span> module. These providers enable using
  two basic approaches when working with JSON format:

  </p><div class="itemizedlist"><ul type="disc"><li>
      <p><a class="link" href="#json.jaxb.approach.title">JAXB based JSON support</a></p>
    </li><li>
      <p><a class="link" href="#json.low.level.approach.title">Low-level, JSONObject/JSONArray based JSON support</a></p>
    </li></ul></div><p>
  
  Both approaches use the same principle. You need to make your resource methods consume and/or produce
  instances of certain Java types, known to provided MessageBodyReaders/Writers. Also, naturally, you need to make sure
  you use <span class="emphasis"><em>jersey-json</em></span> module with your application.
  </p>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e442"></a>2.1.&nbsp;JAXB Based JSON support</h2></div></div></div>
    
    
    <p>
     Taking this approach will save you a lot of time, if you want to easily produce/consume both JSON and XML data format.
     Because even then you will still be able to use a unified Java model. 
     Another advantage is simplicity of working with such a model, as JAXB leverages annotated POJOs and these could be handled
     as simple Java beans
    </p>
    <p>
     A disadvantage of JAXB based approach could be if you need to work with a very specific JSON format. Then it could be
     difficult to find a proper way to get such a format produced and consumed. This is a reason why a lot of configuration options
     are provided, so that you can control how things get serialized out and deserialized back.
    </p>
    
    <p>
    Following is a very simple example of how a JAXB bean could look like.
</p><div class="example"><a name="d4e447"></a><p class="title"><b>Example&nbsp;2.1.&nbsp;Simple JAXB bean implementation</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class MyJaxbBean {
&nbsp;&nbsp;3   public String name;
&nbsp;&nbsp;4   public int age;
&nbsp;&nbsp;5       
&nbsp;&nbsp;6   public MyJaxbBean() {} // JAXB needs this
&nbsp;&nbsp;7 
&nbsp;&nbsp;8   public MyJaxbBean(String name, int age) {
&nbsp;&nbsp;9     this.name = name;
&nbsp;10     this.age = age;
&nbsp;11   }
&nbsp;12 }</pre>
</div></div><p><br class="example-break">
    
    Using the above JAXB bean for producing JSON data format from you resource method, is then as simple as:
    
</p><div class="example"><a name="d4e450"></a><p class="title"><b>Example&nbsp;2.2.&nbsp;JAXB bean used to generate JSON representation</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @GET @Produces(<span class="emphasis"><em>"application/json"</em></span>)
&nbsp;&nbsp;2 public <span class="emphasis"><em>MyJaxbBean</em></span> getMyBean() {
&nbsp;&nbsp;3    return <span class="emphasis"><em>new MyJaxbBean("Agamemnon", 32)</em></span>;
&nbsp;&nbsp;4 }</pre>
</div></div><p><br class="example-break">
    
    Notice, that JSON specific mime type is specified in @Produces annotation, and the method returns an instance
    of MyJaxbBean, which JAXB is able to process. Resulting JSON in this case would look like:
    
</p><pre class="programlisting">
    {"name":"Agamemnon", "age":"32"}
</pre><p>
    </p>
    
    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e457"></a>2.1.1.&nbsp;Configuration Options</h3></div></div></div>
    	
	
	<p>
	JAXB itself enables you to control output JSON format to certain extent. Specifically renaming 
	and ommiting items is easy to do directly using JAXB annotations.
	
	E.g. the following example depicts changes in the above mentioned MyJaxbBean that will result in <code class="code">{"king":"Agamemnon"}</code> JSON output.
</p><div class="example"><a name="d4e461"></a><p class="title"><b>Example&nbsp;2.3.&nbsp;Tweaking JSON format using JAXB</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class MyJaxbBean {
&nbsp;&nbsp;3   
&nbsp;&nbsp;4     @XmlElement(name="king")
&nbsp;&nbsp;5     public String name;
&nbsp;&nbsp;6   
&nbsp;&nbsp;7     @XmlTransient
&nbsp;&nbsp;8     public int age;
&nbsp;&nbsp;9  
&nbsp;10     // several lines removed       
&nbsp;11 }</pre>
</div></div><p><br class="example-break">
	</p>
	
	<p>
	To achieve more important JSON format changes, you will need to configure Jersey JSON procesor itself.
	Various configuration options could be set on  an
	<a class="ulink" href="https://jersey.dev.java.net/nonav/apidocs/1.0.3.1/jersey/com/sun/jersey/api/json/JSONConfiguration.html" target="_top">JSONConfiguration</a>
	instance. The instance could be then further used to create a JSONConfigurated 
	<a class="ulink" href="https://jersey.dev.java.net/nonav/apidocs/1.0.3.1/jersey/com/sun/jersey/api/json/JSONJAXBContext.html" target="_top">JSONJAXBContext</a>,
	which serves as a main configuration point in this area.
	To pass your specialized JSONJAXBContext to Jersey, you will finally need to implement 
	a JAXBContext <a class="ulink" href="https://jsr311.dev.java.net/nonav/releases/1.0/javax/ws/rs/ext/ContextResolver.html" target="_top">ContextResolver</a>
	</p>
	
	<div class="example"><a name="json.jaxb.context.resolver.example"></a><p class="title"><b>Example&nbsp;2.4.&nbsp;An example of a JAXBContext resolver implementation</b></p><div class="example-contents">
	
	<pre class="programlisting">&nbsp;&nbsp;1 @Provider
&nbsp;&nbsp;2 public class JAXBContextResolver implements ContextResolver&lt;JAXBContext&gt; {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     private JAXBContext context;
&nbsp;&nbsp;5     private Class[] types = {MyJaxbBean.class};
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     public JAXBContextResolver() throws Exception {
&nbsp;&nbsp;8         this.context = 
&nbsp;&nbsp;9 	  new JSONJAXBContext( <a name="json.ctx.resolver.init"></a>(1)
&nbsp;10 	    JSONConfiguration.natural().build(), types); <a name="json.ctx.resolver.config"></a>(2)
&nbsp;11     }
&nbsp;12 
&nbsp;13     public JAXBContext getContext(Class&lt;?&gt; objectType) {
&nbsp;14         for (Class type : types) {
&nbsp;15             if (type == objectType) {
&nbsp;16                 return context;
&nbsp;17             }
&nbsp;18         }
&nbsp;19         return null;
&nbsp;20     }
&nbsp;21 }</pre>
	<div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#json.ctx.resolver.init">(1)</a> </p></td><td valign="top" align="left">
	 	<p>Creation of our specialized JAXBContext</p> 
	</td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#json.ctx.resolver.config">(2)</a> </p></td><td valign="top" align="left">
	 	<p>Final JSON format is given by this JSONConfiguration instance</p> 
	</td></tr></table></div>
	</div></div><br class="example-break">
    </div>
    
    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e478"></a>2.1.2.&nbsp;JSON Notations</h3></div></div></div>
     
     <p>
      JSONConfiguration allows you to use four various JSON notations. Each of these notations serializes JSON in a different way.
      Following is a list of supported notations:

      </p><div class="itemizedlist"><ul type="disc"><li>
      <p>MAPPED (default notation)</p>
    </li><li>
      <p>NATURAL</p>
    </li><li>
      <p>JETTISON_MAPPED</p>
    </li><li>
      <p>BADGERFISH</p>
    </li></ul></div><p>
      </p>
      
      <p>
      Individual notations and their further configuration options are described bellow. Rather then explaining rules for mapping
      XML constructs into JSON, the notations will be described using a simple example. Following are JAXB beans, which will be used.
      
      </p><div class="example"><a name="d4e491"></a><p class="title"><b>Example&nbsp;2.5.&nbsp;JAXB beans for JSON supported notations description, simple address bean</b></p><div class="example-contents">
      <pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class Address {
&nbsp;&nbsp;3     public String street;
&nbsp;&nbsp;4     public String town;
&nbsp;&nbsp;5 
&nbsp;&nbsp;6     public Address(){}
&nbsp;&nbsp;7 
&nbsp;&nbsp;8     public Address(String street, String town) {
&nbsp;&nbsp;9         this.street = street;
&nbsp;10         this.town = town;
&nbsp;11     }
&nbsp;12 }</pre>
      </div></div><p><br class="example-break">

      </p><div class="example"><a name="d4e494"></a><p class="title"><b>Example&nbsp;2.6.&nbsp;JAXB beans for JSON supported notations description, contact bean</b></p><div class="example-contents">
      <pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class Contact {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     public int id;
&nbsp;&nbsp;5     public String name;
&nbsp;&nbsp;6     public List&lt;Address&gt; addresses;
&nbsp;&nbsp;7 
&nbsp;&nbsp;8     public Contact() {};
&nbsp;&nbsp;9 
&nbsp;10     public Contact(int id, String name, List&lt;Address&gt; addresses) {
&nbsp;11         this.name = name;
&nbsp;12         this.id = id;
&nbsp;13         this.addresses = 
&nbsp;14 	        (addresses != null) ? new LinkedList&lt;Address&gt;(addresses) : null;
&nbsp;15     }
&nbsp;16 }</pre>
      </div></div><p><br class="example-break">
      </p>
      
      <p>
      Following text will be mainly working with a contact bean initialized with:
      </p><div class="example"><a name="json.jaxb.bean.init.example"></a><p class="title"><b>Example&nbsp;2.7.&nbsp;JAXB beans for JSON supported notations description, initialization</b></p><div class="example-contents">
      <pre class="programlisting">final Address[] addresses = {new Address("Long Street 1", "Short Village")};
Contact contact = new Contact(2, "Bob", Arrays.asList(addresses));</pre>
</div></div><p><br class="example-break">
I.e. contact bean with <code class="code">id=2</code>, <code class="code">name="Bob"</code> containing 
a single address (<code class="code">street="Long Street 1"</code>, <code class="code">town="Short Village"</code>).
      </p>
      
      <p>All bellow described configuration options are documented 
      also in apidocs at <a class="ulink" href="https://jersey.dev.java.net/nonav/apidocs/1.0.3.1/jersey/com/sun/jersey/api/json/JSONConfiguration.html" target="_top">https://jersey.dev.java.net/nonav/apidocs/1.0.3.1/jersey/com/sun/jersey/api/json/JSONConfiguration.html</a>
      </p>
      
      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e507"></a>2.1.2.1.&nbsp;Mapped notation</h4></div></div></div>
       
       <p>
       <code class="code">JSONConfiguration</code> based on <code class="literal">mapped</code> notation could be build with 
       </p><pre class="programlisting">JSONConfiguration.mapped().build()</pre><p>
       for usage in a <code class="code">JAXBContext</code> resolver, <a class="xref" href="#json.jaxb.context.resolver.example" title="Example&nbsp;2.4.&nbsp;An example of a JAXBContext resolver implementation">Example&nbsp;2.4, &#8220;An example of a JAXBContext resolver implementation&#8221;</a>.
       Then a contact bean initialized with <a class="xref" href="#json.jaxb.bean.init.example" title="Example&nbsp;2.7.&nbsp;JAXB beans for JSON supported notations description, initialization">Example&nbsp;2.7, &#8220;JAXB beans for JSON supported notations description, initialization&#8221;</a>, will be serialized as
       </p><div class="example"><a name="d4e516"></a><p class="title"><b>Example&nbsp;2.8.&nbsp;JSON expression produced using <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 { "id":"2" 
&nbsp;&nbsp;2  ,"name":"Bob"
&nbsp;&nbsp;3  ,"addresses":{"street":"Long Street 1"
&nbsp;&nbsp;4                     ,"town":"Short Village"}}</pre>
       </div></div><p><br class="example-break">
       The JSON representation seems fine, and will be working flawlessly with Java based Jersey client API.
       </p>
       <p>
       However, at least one issue might appear once you start using it with a JavaScript based client.
       The information, that <code class="code">addresses</code> item represents an array, is being lost for every single element array. 
       If you added another address bean to the contact,</p><pre class="programlisting">contact.addresses.add(new Address("Short Street 1000", "Long Village"));</pre><p>,
       you would get 
       </p><pre class="programlisting">&nbsp;&nbsp;1 { "id":"2" 
&nbsp;&nbsp;2  ,"name":"Bob"
&nbsp;&nbsp;3  ,"addresses":[{"street":"Long Street 1","town":"Short Village"}
&nbsp;&nbsp;4               ,{"street":"Short Street 1000","town":"Long Village"}]}</pre><p>
        Both representations are correct, but you will not be able to consume them using a single JavaScript client,
	because to access <code class="code">"Short Village"</code> value, you will write <code class="code">addresses.town</code> in one
	case and <code class="code">addresses[0].town</code> in the other.
	To fix this issue, you need to instruct the JSON processor, what items need to be treated as arrays
	by setting an optional property, <code class="literal">arrays</code>, on your <code class="code">JSONConfiguration</code> object.
	For our case, you would do it with
       </p><div class="example"><a name="d4e529"></a><p class="title"><b>Example&nbsp;2.9.&nbsp;Force arrays in <code class="literal">mapped</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.mapped().arrays("addresses").build()</pre>
       </div></div><p><br class="example-break">
       You can use multiple string values in the <code class="literal">arrays</code> method call, in case you are dealing with more
       than one array item in your beans. Similar mechanism (one or more argument values) applies also for all below desribed options.
       </p>
       
       <p>Another issue might be, that number value, <code class="literal">2</code>, for <code class="code">id</code> item 
       gets written as a string, <code class="literal">"2"</code>. To avoid this, you can use another optional property on <code class="code">JSONConfiguration</code>
       called <code class="literal">nonStrings</code>.
       </p><div class="example"><a name="d4e540"></a><p class="title"><b>Example&nbsp;2.10.&nbsp;Force non-string values in <code class="literal">mapped</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.mapped().arrays("addresses").nonStrings("id").build()</pre>
       </div></div><p><br class="example-break">
	</p>       
       
       <p>
       It might happen you use XML attributes in your JAXB beans. In <code class="literal">mapped</code> JSON notation, these attribute names are prefixed with <code class="literal">@</code>
       character. If <code class="code">id</code> was an attribute, it&acute;s definition would look like:
       </p><pre class="programlisting">  ...
  @XmlAttribute
  public int id;
  ...</pre><p>
       and then you would get </p><pre class="programlisting">{"@id":"2" ...</pre><p> at the JSON output.
       In case, you want to get rid of the <code class="literal">@</code> prefix, you can take advantage of another configuration 
       option of <code class="literal">JSONConfiguration</code>, called <code class="literal">attributeAsElement</code>.
       Usage is similar to previous options.
       </p><div class="example"><a name="d4e553"></a><p class="title"><b>Example&nbsp;2.11.&nbsp;XML attributes as XML elements in <code class="literal">mapped</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.mapped().attributeAsElement("id").build()</pre>
       </div></div><p><br class="example-break">
       </p>
	<p>
	<code class="literal">Mapped</code> JSON notation was designed to produce the simplest possible JSON expression out of JAXB beans. While in XML,
	you must always have a root tag to start a XML document with, there is no such a constraint in JSON. If you wanted to be strict,
	you might have wanted to keep a XML root tag equivalent generated in your JSON. If that is the case, another configuration option
	is available for you, which is called <code class="literal">rootUnwrapping</code>. You can use it as follows:
       </p><div class="example"><a name="d4e560"></a><p class="title"><b>Example&nbsp;2.12.&nbsp;Keep XML root tag equivalent in JSON <code class="literal">mapped</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.mapped().rootUnwrapping(false).build()</pre>
       </div></div><p><br class="example-break">
       and get the following JSON for our <code class="literal">Contact</code> bean:
       </p><div class="example"><a name="d4e565"></a><p class="title"><b>Example&nbsp;2.13.&nbsp;XML root tag equivalent kept in JSON using <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 {"contact":{ "id":"2" 
&nbsp;&nbsp;2  ,"name":"Bob"
&nbsp;&nbsp;3  ,"addresses":{"street":"Long Street 1"
&nbsp;&nbsp;4                     ,"town":"Short Village"}}}</pre>
       </div></div><p><br class="example-break">
	<code class="literal">rootUnwrapping</code> option is set to <code class="literal">true</code> by default.
	</p>
      </div>
      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e571"></a>2.1.2.2.&nbsp;Natural notation</h4></div></div></div>
       
       <p>
       After using <code class="literal">mapped</code> JSON notation for a while, it was apparent, that a need to configure all the various things
       manually could be a bit problematic. To avoid the manual work, a new, <code class="literal">natural</code>, JSON notation was introduced in Jersey version 1.0.2.
       With <code class="literal">natural</code> notation, Jersey will automatically figure out how individual items need to be processed, so that you 
       do not need to do any kind of manual configuration. Java arrays and lists are mapped into JSON arrays, even for single-element cases. 
       Java numbers and booleans are correctly mapped into JSON numbers and booleans, and you do not need to bother with XML attributes,
       as in JSON, they keep the original names. So  without any additional configuration, just using
       </p><pre class="programlisting">JSONConfiguration.natural().build()</pre><p>
       for configuring your <code class="code">JAXBContext</code>, you will get the following JSON for the bean 
       initialized at <a class="xref" href="#json.jaxb.bean.init.example" title="Example&nbsp;2.7.&nbsp;JAXB beans for JSON supported notations description, initialization">Example&nbsp;2.7, &#8220;JAXB beans for JSON supported notations description, initialization&#8221;</a>:
       </p><div class="example"><a name="d4e580"></a><p class="title"><b>Example&nbsp;2.14.&nbsp;JSON expression produced using <code class="literal">natural</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 { "id":2
&nbsp;&nbsp;2  ,"name":"Bob"
&nbsp;&nbsp;3  ,"addresses":[{"street":"Long Street 1"
&nbsp;&nbsp;4                      ,"town":"Short Village"}]}</pre>
       </div></div><p><br class="example-break">
       You might notice, that the single element array <code class="literal">addresses</code> remains an array, and also the non-string <code class="literal">id</code>
       value is not limited with double quotes, as <code class="literal">natural</code> notation automatically detects these things.
       </p>
      </div>
      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e587"></a>2.1.2.3.&nbsp;Jettison mapped notation</h4></div></div></div>
       
       <p>
       Next two notations are based on project <a class="ulink" href="http://jettison.codehaus.org/User%27s+Guide" target="_top">Jettison</a>.
       You might want to use one of these notations, when working with more complex XML documents. Namely when you deal with 
       multiple XML namespaces in your JAXB beans. 
       </p>
       <p>
       Jettison based <code class="literal">mapped</code> notation could be configured using:
       </p><pre class="programlisting">JSONConfiguration.mappedJettison().build()</pre><p>
       If nothing else is configured, you will get similar JSON output as for the default, <code class="literal">mapped</code>, notation:
       </p><div class="example"><a name="d4e595"></a><p class="title"><b>Example&nbsp;2.15.&nbsp;JSON expression produced using Jettison based <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 { "contact:{"id":2
&nbsp;&nbsp;2               ,"name":"Bob"
&nbsp;&nbsp;3               ,"addresses":{"street":"Long Street 1"
&nbsp;&nbsp;4                                  ,"town":"Short Village"}}</pre>
       </div></div><p><br class="example-break">
	The only difference is, your numbers and booleans will not be converted into strings, but you have no option for forcing arrays remain arrays
	in single-element case. Also the JSON object, representing XML root tag is being produced.
       </p>
       <p>
       If you need to deal with various XML namespaces, however, you will find Jettison <code class="literal">mapped</code> notation pretty useful.
       Lets define a particular namespace for <code class="code">id</code> item:
       </p><pre class="programlisting">  ...
  @XmlElement(namespace="http://example.com")
  public int id;
  ...</pre><p>
 	Then you simply confgure a mapping from XML namespace into JSON prefix as follows:
      </p><div class="example"><a name="d4e603"></a><p class="title"><b>Example&nbsp;2.16.&nbsp;XML namespace to JSON mapping configuration for Jettison based <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1         Map&lt;String,String&gt; ns2json = new HashMap&lt;String, String&gt;();
&nbsp;&nbsp;2         ns2json.put("http://example.com", "example");
&nbsp;&nbsp;3         context = new JSONJAXBContext(
&nbsp;&nbsp;4 	      JSONConfiguration.mappedJettison()
&nbsp;&nbsp;5 	           .xml2JsonNs(ns2json).build(), types);</pre>
       </div></div><p><br class="example-break">
       Resulting JSON will look like in the example bellow.
        </p><div class="example"><a name="d4e607"></a><p class="title"><b>Example&nbsp;2.17.&nbsp;JSON expression with XML namespaces mapped into JSON</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 { "contact:{"example.id":2
&nbsp;&nbsp;2               ,"name":"Bob"
&nbsp;&nbsp;3               ,"addresses":{"street":"Long Street 1"
&nbsp;&nbsp;4                                  ,"town":"Short Village"}}</pre>
       </div></div><p><br class="example-break">
       Please note, that <code class="code">id</code> item became <code class="code">example.id</code> based on the XML namespace mapping.
       If you have more XML namespaces in your XML, you will need to configure appropriate mapping for all of them
       </p>
      </div>
      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e612"></a>2.1.2.4.&nbsp;Badgerfish notation</h4></div></div></div>
       
       <p>
       Badgerfish notation is the other notation based on Jettison. From JSON and JavaScript perspective, this notation is definitely
       the worst readable one. You will probably not want to use it, unless you need to make sure your JAXB beans could be flawlessly
       written and read back to and from JSON, without bothering with any formatting configuration, namespaces, etc.
       </p>
       <p>
       <code class="code">JSONConfiguration</code> instance using <code class="literal">badgerfish</code> notation could be built with
       </p><pre class="programlisting">JSONConfiguration.badgerFish().build()</pre><p>
       and the output JSON for <a class="xref" href="#json.jaxb.bean.init.example" title="Example&nbsp;2.7.&nbsp;JAXB beans for JSON supported notations description, initialization">Example&nbsp;2.7, &#8220;JAXB beans for JSON supported notations description, initialization&#8221;</a> will be as follows.
       </p><div class="example"><a name="d4e620"></a><p class="title"><b>Example&nbsp;2.18.&nbsp;JSON expression produced using <code class="literal">badgerfish</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 {"contact":{"id":{"$":"2"}
&nbsp;&nbsp;2               ,"name":{"$":"Bob"}
&nbsp;&nbsp;3               ,"addresses":{"street":{"$":"Long Street 1"}
&nbsp;&nbsp;4                                  ,"town":{"$":"Short Village"}}}}</pre>
       </div></div><p><br class="example-break">
       </p>
      </div>
      
    </div>
<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e624"></a>2.1.3.&nbsp;Examples</h3></div></div></div>
   <p>Download <a class="ulink" href="http://download.java.net/maven/2/com/sun/jersey/samples/json-from-jaxb/1.0.3.1/json-from-jaxb-1.0.3.1-project.zip" target="_top">http://download.java.net/maven/2/com/sun/jersey/samples/json-from-jaxb/1.0.3.1/json-from-jaxb-1.0.3.1-project.zip</a>
   or
   <a class="ulink" href="http://download.java.net/maven/2/com/sun/jersey/samples/jmaki-backend/1.0.3.1/jmaki-backend-1.0.3.1-project.zip" target="_top">http://download.java.net/maven/2/com/sun/jersey/samples/jmaki-backend/1.0.3.1/jmaki-backend-1.0.3.1-project.zip</a>
   to get a more complex example using JAXB based JSON support.
   </p>
   </div>
  
   </div>
  

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e629"></a>2.2.&nbsp;Low-Level JSON support</h2></div></div></div>
    

    <p>Using this approach means you will be using JSONObject and/or JSONArray classes for your data representations.
    These classes are actually taken from Jettison project, but conform to the description 
    provided at <a class="ulink" href="http://www.json.org/java/index.html" target="_top"> http://www.json.org/java/index.html</a>.
    </p>
    
    <p>
    The biggest advantage here is, that you will gain full control over the JSON format produced and consumed.
    On the other hand, dealing with your data model objects will probably be a bit more complex, than when taking the JAXB based approach.
    Differencies are depicted at the following code snipets.
    </p>
    
    <p>
    </p><div class="example"><a name="d4e635"></a><p class="title"><b>Example&nbsp;2.19.&nbsp;JAXB bean creation</b></p><div class="example-contents">
    <pre class="programlisting">MyJaxbBean myBean = new MyJaxbBean("Agamemnon", 32);</pre>
    </div></div><p><br class="example-break">
    
    Above you construct a simple JAXB bean, which could be written in JSON as <code class="code">{"name":"Agamemnon", "age":32}</code>
    </p>
    
    <p>
    Now to build an equivalent JSONObject (in terms of resulting JSON expression), you would need several more lines of code.
    
    </p><div class="example"><a name="d4e640"></a><p class="title"><b>Example&nbsp;2.20.&nbsp;Constructing a JSONObject</b></p><div class="example-contents">
    
 <pre class="programlisting">&nbsp;&nbsp;1 JSONObject myObject = new JSONObject();
&nbsp;&nbsp;2 myObject.JSONObject myObject = new JSONObject();
&nbsp;&nbsp;3 try {
&nbsp;&nbsp;4   myObject.put("name", "Agamemnon");
&nbsp;&nbsp;5   myObject.put("age", 32);
&nbsp;&nbsp;6 } catch (JSONException ex) {
&nbsp;&nbsp;7   LOGGER.log(Level.SEVERE, "Error ...", ex);
&nbsp;&nbsp;8 }</pre>
    </div></div><p><br class="example-break">
    </p>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e643"></a>2.2.1.&nbsp;Examples</h3></div></div></div>

   <p>Download <a class="ulink" href="http://download.java.net/maven/2/com/sun/jersey/samples/bookmark/1.0.3.1/bookmark-1.0.3.1-project.zip" target="_top">http://download.java.net/maven/2/com/sun/jersey/samples/bookmark/1.0.3.1/bookmark-1.0.3.1-project.zip</a> 
   to get a more complex example using low-level JSON support.
   </p>
   
  </div>
</div>
</div>

</div></body></html>